{% extends 'base.html' %}
{% load static %}
{% load number_filter %}
{% block title %}NyumbaFinder KE - Find Verified Homes in Nairobi{% endblock %}

{% block content %}
    <style>
        #typewriter {
            display: inline-block;
            white-space: nowrap;
            overflow: hidden;
            border-right: 4px solid transparent; /* hides default cursor */
        }

        .cursor {
            font-weight: bold;
            color: #6366f1;
            font-size: 1.1em;
            animation: blink 0.9s infinite;
            margin-left: 4px;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* For looping version */
        .typewriter-wrapper {
            display: inline-block;
            min-width: 300px; /* prevents layout jump */
        }
    </style>
    {% include 'partials/messages.html' %}
    <section class="relative overflow-hidden py-1 px-6">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h1 class="text-2xl sm:text-3xl md:text-5xl lg:text-6xl font-bold text-white leading-tight">
                <span class="typewriter-wrapper inline-block">
                <span id="typewriter"></span>
                <span class="cursor">|</span>
                </span>
            </h1>
        </div>
    </section>
    <section class="py-14 px-1 md:px-3 lg:px-4 bg-[var(--bg)] w-full flex items-center justify-center">
        <div class="w-[98vw] max-w-[98vw] md:max-w-8xl lg:max-w-7xl mx-auto">
            {% if houses %}
                <div class="glass-wrapper bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-4 md:p-6 lg:p-8 mb-4 w-full">
                    <!-- Header with search/filter/sort - only show if houses exist -->
                    <div class="flex items-center justify-between mb-6 md:mb-8">
                        <div >
                            <h2 class="text-xl md:text-2xl lg:text-3xl font-bold text-white">
                                Available Houses
                                {% comment %} <span class="text-[var(--primary)]">({{ houses|length }})</span> {% endcomment %}
                            </h2>
                            <p class="text-xs md:text-sm text-gray-400 mt-1 md:mt-2">Find your perfect home from our curated selection</p>
                            <span class="text-[var(--primary)] text-xs md:text-sm mt-1 md:mt-2">({{ paginator.count|humanize_number }}){% if paginator.count <= 1%} Result found {% else %} Results found{% endif %}</span>
                            <p class="w-fit bg-[var(--bg)] px-2 py-1  text-center rounded-lg text-xs md:text-sm text-gray-400 mt-1 md:mt-2">
                                    Showing {{ houses.start_index }}-{{ houses.end_index }} of {{ paginator.count }} houses
                            </p>
                        </div>

                        <div class="flex items-center justify-end gap-2">
                            <!-- Search Component -->
                            {% include 'partials/search_part.html' %}

                             <!-- Sort and Filter Buttons -->
                            <div class="flex items-center gap-2">
                                <!-- Sort Component -->
                                {% include 'partials/sort_part.html' %}
                             
                                <!-- Filter Component -->
                                {% include 'partials/filter_part.html' %}
                               
                            </div>
                        </div>
                    </div>
                    <div class="houses-content">
                            {% if houses_page.object_list.count|length < 4 %}
                                {% comment %} <div class="grid justify-center gap-3 md:gap-4 lg:gap-6" 
     style="grid-template-columns: repeat(auto-fit, minmax(270px, max-content));"> {% endcomment %}
                                <div class="grid grid-cols-2  lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 justify-items-center gap-3 md:gap-4 lg:gap-6">
                                    {% for house in houses %}
                                        {% comment %} <div class="w-full flex-3 max-w-sm"> {% endcomment %}
                                        <div class="w-full {% if houses|length >= 4 %}max-w-full{% else %}max-w-sm{% endif %}">
                                            {% include 'partials/house_part.html' %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <!-- Normal grid layout for many houses -->
                                <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3 md:gap-4 lg:gap-6">
                                    {% for house in houses %}
                                        <div class="w-full max-w-sm">
                                            {% include 'partials/house_part.html' %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <!-- Pagination Controls -->
                        {% include 'partials/pagination.html' %}                    
                </div>
            {% else %}
                <!-- Empty state - no glass wrapper when no houses -->
                <div class="text-center py-20">
                    <div class="w-32 h-32 bg-gradient-to-br from-white/10 to-white/5 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-sm border border-white/10">
                        <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-400 mb-3">No Houses Available</h3>
                    <p class="text-gray-500 text-lg max-w-md mx-auto">
                        There are currently no houses matching your criteria. Check back later or try different filters.
                    </p>
                </div>
            {% endif %}
        </div>

            
        {% comment %} </div>
        </div> {% endcomment %}

       
    </section>
    {% include 'partials/search_overlay_part.html' %}

    {% include 'partials/messages_js.html' %}
    {% include 'partials/sort_js.html' %}
    {% include 'partials/filter_js.html' %}
    {% include 'partials/search_js.html' %}
    <script>
        // CONFIGURE YOUR PHRASES HERE
        const phrases = [
            "Pata Keja Yako Bila Stress.",
            "Only Verified Houses in Kenya.",
            "Your Trusted House Finder."
        ];

        let phraseIndex = 0;
        let i = 0;
        const typewriter = document.getElementById("typewriter");
        const cursor = document.querySelector(".cursor");

        function type() {
            const currentPhrase = phrases[phraseIndex];

            if (i < currentPhrase.length) {
            typewriter.innerHTML += currentPhrase.charAt(i);
            i++;
            setTimeout(type, 120); // typing speed
            } else {
            // Finished typing → wait 2 sec → delete → next phrase
            setTimeout(deleteText, 2500);
            }
        }

        function deleteText() {
            if (i > 0) {
            typewriter.innerHTML = typewriter.innerHTML.slice(0, -1);
            i--;
            setTimeout(deleteText, 120); // deleting speed
            } else {
            phraseIndex = (phraseIndex + 1) % phrases.length;
            setTimeout(type, 1500);
            }
        }

        // Start when page loads
        window.addEventListener("load", () => {
            cursor.style.opacity = "1";
            setTimeout(type, 800);
        });
    </script>
{% endblock %}

<!-- Filter Component with Payment Status -->
<div class="relative" data-filter-dropdown>
    <button class="flex items-center gap-1 sm:gap-2 p-2 sm:p-3 bg-white/5 rounded-xl sm:rounded-2xl border border-white/10 hover:border-[var(--primary)] transition text-gray-400 hover:text-white text-sm backdrop-blur-sm">
        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"/>
        </svg>
        <span class="hidden xs:inline">Filter</span>
        <!-- Show filter count badge -->
        {% with active_filters=0 %}
            {% if request.GET.house_type %}{{ active_filters|add:1 }}{% endif %}
            {% if user.is_authenticated and request.GET.payment_status %}{{ active_filters|add:1 }}{% endif %}
            {% if user.is_authenticated and request.GET.status %}{{ active_filters|add:1 }}{% endif %}
            {% if request.GET.min_rent %}{{ active_filters|add:1 }}{% endif %}
            {% if request.GET.max_rent %}{{ active_filters|add:1 }}{% endif %}
            {% if active_filters > 0 %}
            <span class="inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-[var(--primary)] rounded-full">
                {{ active_filters }}
            </span>
            {% endif %}
        {% endwith %}
    </button>
    
    <!-- Filter Dropdown Menu -->
    <div class="filter-dropdown-menu hidden absolute right-0 w-72 sm:w-80 bg-[var(--bg-light)] border border-[var(--border)] rounded-xl shadow-xl py-3 z-[100] max-h-[80vh] overflow-y-auto">
        <form method="GET" action="{% url 'home' %}" id="filterForm">
            <!-- Hidden fields to preserve search and sort -->
            <input type="hidden" name="search" value="{{ request.GET.search }}">
            <input type="hidden" name="sort" value="{{ request.GET.sort }}">
            
            {% if user.is_authenticated %}
                <!-- Payment Status Filter (NEW) -->
                <div class="px-4 py-2 border-b border-[var(--border)]">
                    <label class="text-xs sm:text-sm font-semibold text-gray-400 mb-2 block">Payment Status</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="payment_status" value="" 
                                {% if not request.GET.payment_status %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-xs sm:text-sm">All Payment Status</span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="payment_status" value="paid" 
                                {% if request.GET.payment_status == "paid" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                Paid & Active
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="payment_status" value="pending" 
                                {% if request.GET.payment_status == "pending" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                Payment Pending
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="payment_status" value="unpaid" 
                                {% if request.GET.payment_status == "unpaid" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                Unpaid
                            </span>
                        </label>
                    </div>
                </div>
            {% endif%}
            
            <!-- House Type Filter -->
            <div class="px-4 py-2 border-b border-[var(--border)]">
                <label class="text-xs sm:text-sm font-semibold text-gray-400 mb-2 block">House Type</label>
                <select name="house_type" class="text-xs sm:text-sm w-full bg-[var(--bg)] text-white rounded-lg p-2 border border-[var(--border)] focus:border-[var(--primary)] focus:outline-none focus:ring-1 focus:ring-[var(--primary)]">
                    <option value="">All Types</option>
                    {% for type_value, type_label in house_types %}
                    <option value="{{ type_value }}" {% if request.GET.house_type == type_value %}selected{% endif %}>
                        {{ type_label }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            {% if user.is_authenticated %}
                <!-- Listing Status Filter (for user's own listings) -->
                <div class="px-4 py-2 border-b border-[var(--border)]">
                    <label class="text-sm font-semibold text-gray-400 mb-2 block">Listing Status</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="status" value="" 
                                {% if not request.GET.status %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-xs sm:text-sm">All Status</span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="status" value="approved" 
                                {% if request.GET.status == "approved" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                Approved
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="status" value="pending" 
                                {% if request.GET.status == "pending" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                Pending
                            </span>
                        </label>
                    </div>
                </div>
            {% endif %}

            <!-- Rent Range Filter -->
            <div class="px-4 py-2 border-b border-[var(--border)]">
                <label class="text-sm font-semibold text-gray-400 mb-2 block">Rent Range</label>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Min Rent</label>
                        <input type="number" 
                            name="min_rent" 
                            placeholder="0" 
                            min="0"
                            value="{{ request.GET.min_rent }}"
                            class="w-full bg-[var(--bg)] text-white rounded-lg p-2 border border-[var(--border)] text-sm focus:border-[var(--primary)] focus:outline-none focus:ring-1 focus:ring-[var(--primary)]">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Max Rent</label>
                        <input type="number" 
                            name="max_rent" 
                            placeholder="100000" 
                            min="0"
                            value="{{ request.GET.max_rent }}"
                            class="w-full bg-[var(--bg)] text-white rounded-lg p-2 border border-[var(--border)] text-sm focus:border-[var(--primary)] focus:outline-none focus:ring-1 focus:ring-[var(--primary)]">
                    </div>
                </div>
            </div>
            
            <!-- Listing Activity Filter (for user's own listings) -->
            {% if user.is_authenticated and request.path == '/dashboard/' %}
            <div class="px-4 py-2 border-b border-[var(--border)]">
                <label class="text-sm font-semibold text-gray-400 mb-2 block">Listing Activity</label>
                <div class="space-y-2">
                    <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                        <input type="radio" name="activity" value="" 
                            {% if not request.GET.activity %}checked{% endif %}
                            class="text-[var(--primary)] focus:ring-[var(--primary)]">
                        <span class="text-white text-xs sm:text-sm">All Listings</span>
                    </label>
                    <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                        <input type="radio" name="activity" value="active" 
                            {% if request.GET.activity == "active" %}checked{% endif %}
                            class="text-[var(--primary)] focus:ring-[var(--primary)]">
                        <span class="text-white text-sm flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            Active Only
                        </span>
                    </label>
                    <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                        <input type="radio" name="activity" value="inactive" 
                            {% if request.GET.activity == "inactive" %}checked{% endif %}
                            class="text-[var(--primary)] focus:ring-[var(--primary)]">
                        <span class="text-white text-sm flex items-center gap-2">
                            <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                            Inactive Only
                        </span>
                    </label>
                </div>
            </div>
            {% endif %}
            
            <!-- Action Buttons -->
            <div class="px-4 py-2 flex gap-2">
                <button type="submit" class="flex-1 bg-[var(--primary)] text-white py-2 rounded-lg hover:bg-[var(--primary-light)] transition flex items-center justify-center gap-2 text-sm font-semibold">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Apply Filters
                </button>
                <a href="{% url 'home' %}" class="flex-1 bg-[var(--bg)] text-gray-400 py-2 rounded-lg border border-[var(--border)] hover:text-white transition text-center flex items-center justify-center gap-2 text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                    Clear All
                </a>
            </div>
        </form>
    </div>
</div>
{% comment %} <!-- Filter Component -->
<div class="relative" data-filter-dropdown>
    <button class="flex items-center gap-1 sm:gap-2 p-2 sm:p-3 bg-white/5 rounded-xl sm:rounded-2xl border border-white/10 hover:border-[var(--primary)] transition text-gray-400 hover:text-white text-sm backdrop-blur-sm">
        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"/>
        </svg>
        <span class="hidden xs:inline">Filter</span>
    </button>
    
    <!-- Filter Dropdown Menu -->
    <div class="filter-dropdown-menu hidden absolute right-0 w-72 sw-72 sm:w-72 bg-[var(--bg-light)] border border-[var(--border)] rounded-xl shadow-xl py-3 z-[100]">
        <form method="GET" action="{% url 'home' %}" id="filterForm">
            <!-- Hidden fields to preserve search and sort -->
            <input type="hidden" name="search" value="{{ request.GET.search }}">
            <input type="hidden" name="sort" value="{{ request.GET.sort }}">
            
            <!-- House Type Filter -->
            <div class="px-4 py-2 border-b border-[var(--border)]">
                <label class="text-xs sm:text-sm font-semibold font-semibold text-gray-400 mb-2 block">House Type</label>
                <select name="house_type" class="text-xs sm:text-sm w-full bg-[var(--bg)] text-white rounded-lg p-2 border border-[var(--border)] text-sm focus:border-[var(--primary)] focus:outline-none focus:ring-1 focus:ring-[var(--primary)]">
                    <option value="">All Types</option>
                    {% for type_value, type_label in house_types %}
                    <option value="{{ type_value }}" {% if request.GET.house_type == type_value %}selected{% endif %}>
                        {{ type_label }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            {% if user.is_authenticated %}
                <!-- Status Filter -->
                <div class="px-4 py-2 border-b border-[var(--border)]">
                    <label class="text-sm font-semibold text-gray-400 mb-2 block">Status</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="status" value="" 
                                {% if not request.GET.status %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-xs sm:text-sm">All Status</span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="status" value="approved" 
                                {% if request.GET.status == "approved" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                Approved
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--bg)] cursor-pointer">
                            <input type="radio" name="status" value="pending" 
                                {% if request.GET.status == "pending" %}checked{% endif %}
                                class="text-[var(--primary)] focus:ring-[var(--primary)]">
                            <span class="text-white text-sm flex items-center gap-2">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                Pending
                            </span>
                        </label>
                    </div>
                </div>
            {% endif %}

            <!-- Rent Range Filter (Optional) -->
            <div class="px-4 py-2 border-b border-[var(--border)]">
                <label class="text-sm font-semibold text-gray-400 mb-2 block">Rent Range</label>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Min Rent</label>
                        <input type="number" 
                            name="min_rent" 
                            placeholder="0" 
                            value="{{ request.GET.min_rent }}"
                            class="w-full bg-[var(--bg)] text-white rounded-lg p-2 border border-[var(--border)] text-sm focus:border-[var(--primary)] focus:outline-none focus:ring-1 focus:ring-[var(--primary)]">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Max Rent</label>
                        <input type="number" 
                            name="max_rent" 
                            placeholder="100000" 
                            value="{{ request.GET.max_rent }}"
                            class="w-full bg-[var(--bg)] text-white rounded-lg p-2 border border-[var(--border)] text-sm focus:border-[var(--primary)] focus:outline-none focus:ring-1 focus:ring-[var(--primary)]">
                    </div>
                </div>
            </div>
            
            <!-- Active Filters Count -->
            {% with active_filters=0 %}
                {% if request.GET.house_type %}{{ active_filters|add:1 }}{% endif %}
                {% if request.GET.payment_status %}{{ active_filters|add:1 }}{% endif %}
                {% if user.is_authenticated %}  {% if request.GET.status %}{{ active_filters|add:1 }}{% endif %} {% endif %}
                {% if request.GET.min_rent %}{{ active_filters|add:1 }}{% endif %}
                {% if request.GET.max_rent %}{{ active_filters|add:1 }}{% endif %}
            {% endwith %}
            
            <!-- Action Buttons -->
            <div class="px-4 py-2 flex gap-2">
                <button type="submit" class="flex-1 bg-[var(--primary)] text-white py-2 rounded-lg hover:bg-[var(--primary-light)] transition flex items-center justify-center gap-2 text-sm font-semibold">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Apply Filters
                </button>
                <a href="{% url 'home' %}" class="flex-1 bg-[var(--bg)] text-gray-400 py-2 rounded-lg border border-[var(--border)] hover:text-white transition text-center flex items-center justify-center gap-2 text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                    Clear All
                </a>
            </div>
        </form>
    </div>
</div> {% endcomment %}